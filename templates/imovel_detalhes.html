{% extends "layout.html" %}

{% block title %}{{ imovel.titulo }} - Seu Novo Imóvel{% endblock %}

{% block content %}
<div class="voltar-link-container">
    <a href="javascript:history.back()"><i class="fa-solid fa-arrow-left"></i> Voltar</a>
</div>

<div class="detalhe-bloco">
    <div class="bloco-imagem">
        {% if imovel.imagens %}
            <img src="{{ imovel.imagens[0].url_imagem }}" alt="Foto principal de {{ imovel.titulo }}">
        {% else %}
            <img src="https://placehold.co/800x600/EFEFEF/333333?text=Sem+Foto" alt="Imóvel sem foto">
        {% endif %}
    </div>
    <div class="bloco-info">
        <h1>{{ imovel.titulo }}</h1>
        <p class="localizacao">{{ imovel.bairro }}, {{ imovel.cidade }} - {{ imovel.estado }}</p>
        
        <ul class="specs-imovel">
            <li><i class="fa-solid fa-ruler-combined"></i> {{ imovel.area_construida|int }} m²</li>
            <li><i class="fa-solid fa-bed"></i> {{ imovel.quartos }} Quarto(s)</li>
            <li><i class="fa-solid fa-shower"></i> {{ imovel.banheiros }} Banheiro(s)</li>
            <li><i class="fa-solid fa-car"></i> {{ imovel.vagas }} Vaga(s)</li>
            {% if imovel.vagas_cobertas and imovel.vagas_cobertas > 0 %}
                <li><i class="fa-solid fa-car-tunnel"></i> {{ imovel.vagas_cobertas }} Vaga(s) Coberta(s)</li>
            {% endif %}
            {% if imovel.piscina == 1 %}
                <li><i class="fa-solid fa-water-ladder"></i> Com Piscina</li>
            {% endif %}
            {% if imovel.area_gourmet == 1 %}
                <li><i class="fa-solid fa-utensils"></i> Área Gourmet</li>
            {% endif %}
        </ul>

                <!-- ÁREA ATUALIZADA: PREÇO E FORMULÁRIO -->
        <div class="bloco-preco-e-acao">
            <p class="preco-detalhe">R$ {{ "%.2f"|format(imovel.preco)|replace('.', ',') }}</p>

            <!-- 1. O ÚNICO BOTÃO, que agora é o nosso gatilho -->
            <button type="button" id="gatilho-form" class="btn btn-contato">Tenho Interesse</button>

            <!-- 2. O formulário fica aqui dentro, mas escondido -->
            <div id="container-form-lead" class="form-escondido">
                <h3 class="form-title">Ótimo! Preencha seus dados para continuar.</h3>
                <form method="POST" action="{{ url_for('imovel_detalhes', imovel_id=imovel.id_imovel) }}" class="form-lead">
                    <div class="form-group">
                        <label for="nome">Nome completo</label>
                        <input type="text" id="nome" name="nome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Seu melhor e-mail</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone / WhatsApp</label>
                        <input type="tel" id="telefone" name="telefone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="mensagem">Mensagem (opcional)</label>
                        <textarea id="mensagem" name="mensagem" class="form-control" rows="3" placeholder="Olá, tenho interesse neste imóvel e gostaria de mais informações."></textarea>
                    </div>
                    <button type="submit" class="btn btn-contato">Entrar em Contato</button>
                </form>
            </div>
        </div>

    </div>
</div>


<div class="descricao-imovel">
    <h2>Descrição do Imóvel</h2>
    <p>{{ imovel.descricao | safe }}</p>
</div>

<section class="carrossel-container">
    <h2>Outros imóveis que podem te interessar</h2>
    <div class="carrossel-wrapper">
        <button class="carrossel-btn btn-prev"><i class="fa-solid fa-chevron-left"></i></button>
        <div class="carrossel-track">
            {% for outro_imovel in outros_imoveis %}
                <div class="card-imovel">
                    {% if outro_imovel.imagens %}
                        <img src="{{ outro_imovel.imagens[0].url_imagem }}" alt="Foto do {{ outro_imovel.titulo }}">
                    {% else %}
                        <img src="https://placehold.co/400x250/EFEFEF/333333?text=Sem+Foto" alt="Imóvel sem foto">
                    {% endif %}
                    <div class="card-content">
                        <h3>{{ outro_imovel.titulo }}</h3>
                        <p class="preco">R$ {{ "%.2f"|format(outro_imovel.preco)|replace('.', ',') }}</p>
                        <a href="{{ url_for('imovel_detalhes', imovel_id=outro_imovel.id_imovel) }}" class="btn">Ver detalhes</a>
                    </div>
                </div>
            
        </div>
        <button class="carrossel-btn btn-next"><i class="fa-solid fa-chevron-right"></i></button>
        <div class="form-actions">
        <button type="submit" class="btn btn-enviar">Enviar por E-mail</button>
        
        <!-- NOVO BOTÃO WHATSAPP (só aparece se o link existir) -->
        {% if link_whatsapp %}
        <a href="{{ link_whatsapp }}" class="btn btn-whatsapp" target="_blank" rel="noopener noreferrer">
            <i class="fa-brands fa-whatsapp"></i>
            <span>Chamar no WhatsApp</span>
        </a>
        {% endif %}
        {% endfor %}
    </div>
    </div>
</section>
{% endblock %}


{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const track = document.querySelector('.carrossel-track');
    if (!track) return;

    const prevBtn = document.querySelector('.btn-prev');
    const nextBtn = document.querySelector('.btn-next');
    const card = track.querySelector('.card-imovel');

    if (card && prevBtn && nextBtn) {
        // Pega a largura do card + gap do CSS
        const gap = parseFloat(getComputedStyle(track).gap);
        const cardWidth = card.offsetWidth + gap;

        nextBtn.addEventListener('click', () => {
            track.scrollBy({ left: cardWidth, behavior: 'smooth' });
        });

        prevBtn.addEventListener('click', () => {
            track.scrollBy({ left: -cardWidth, behavior: 'smooth' });
        });
    }
});
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const mostrarFormularioBtn = document.getElementById('mostrarFormulario');
        const containerFormularioDiv = document.getElementById('containerFormulario');

        if (mostrarFormularioBtn && containerFormularioDiv) {
            mostrarFormularioBtn.addEventListener('click', function() {
                containerFormularioDiv.style.display = 'block'; // Ou 'flex' se o layout do container precisar ser flex
                mostrarFormularioBtn.style.display = 'none'; // Oculta o botão após clicar
            });
        }
    });
</script>

<script>
    const botaoGatilho = document.getElementById('gatilho-form');
    const containerForm = document.getElementById('container-form-lead');

    if (botaoGatilho && containerForm) {
        botaoGatilho.addEventListener('click', function() {
            // Esconde o botão "Tenho Interesse"
            this.style.display = 'none';
            // Mostra o container do formulário
            containerForm.style.display = 'block';
        });
    }
</script>
{% endblock %}